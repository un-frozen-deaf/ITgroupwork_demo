<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ITプロジェクト</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
        position: relative;
      }
      h1 {
        color: #333;
      }
      .image-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
      }
      .image-container img {
        max-width: 30%; /* 3つ並べて表示 */
        height: auto;
        margin: 10px;
      }
      .buttons {
        margin-top: 20px;
      }
      button {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        margin: 10px;
        display: none; /* 初期状態では非表示 */
      }
      button:hover {
        background-color: #45a049;
      }
      #audio-icon {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 50px;
        display: none; /* 初期状態では非表示 */
      }
      .blinking {
        animation: blink 1s infinite;
      }
      @keyframes blink {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <h1>結果</h1>
    <div class="image-container" id="image-container"></div>
    <img id="audio-icon" src="images/audio_icon.png" alt="音声アイコン" />

    <p id="result-message"></p>

    <div class="buttons">
      <button id="retry-button">もう一度</button>
      <button id="exit-button">ゲームを終了する</button>
    </div>

    <script>
      // localStorage から選択した内容を取得
      const selectedChoice1 = localStorage.getItem("selectedChoice1");

      // エピソードごとの画像と音声
      const episodes = {
        choice1: {
          images: [
            "images/image_A_bad.jpg",
            "images/image_B_bad.jpg",
            "images/image_C_bad.jpg",
          ],
          audios: [
            "audios/IT-A04.wav",
            "audios/IT-B04.wav",
            "audios/IT-C04.wav",
          ],
          message: "残念！",
        },
        choice2: {
          images: [
            "images/image_A_good.jpg",
            "images/image_B_good.jpg",
            "images/image_C_good.jpg",
          ],
          audios: [
            "audios/IT-A03.wav",
            "audios/IT-B03.wav",
            "audios/IT-C03.wav",
          ],
          message: "正解！",
        },
        choice3: {
          images: [
            "images/image_A_bad.jpg",
            "images/image_B_bad.jpg",
            "images/image_C_bad.jpg",
          ],
          audios: [
            "audios/IT-A05.wav",
            "audios/IT-B05.wav",
            "audios/IT-C05.wav",
          ],
          message: "残念！",
        },
        choice4: {
          images: [
            "images/image_A_bad.jpg",
            "images/image_B_bad.jpg",
            "images/image_C_bad.jpg",
          ],
          audios: ["audios/IT-A06.wav", "audios/IT-C06.wav"],
          message: "残念！",
        },
      };

      const audioIcon = document.getElementById("audio-icon");
      const imageContainer = document.getElementById("image-container");
      const resultMessage = document.getElementById("result-message");

      // 選択に応じてエピソードを再生
      function playEpisode(choice) {
        const { images, audios, message } = episodes[choice];

        // 画像を表示
        imageContainer.innerHTML = images
          .map((src) => `<img src="${src}" alt="エピソード画像" />`)
          .join("");

        // メッセージを表示
        resultMessage.textContent = message;

        let audioIndex = 0;
        const audioPlayer = new Audio(audios[audioIndex]);
        startBlinkingIcon();

        audioPlayer.addEventListener("ended", function () {
          audioIndex++;
          if (audioIndex < audios.length) {
            audioPlayer.src = audios[audioIndex];
            audioPlayer.play();
          } else {
            stopBlinkingIcon();
            showButtons(); // 音声がすべて再生終了後にボタンを表示
          }
        });

        audioPlayer.play();
      }

      function startBlinkingIcon() {
        audioIcon.style.display = "block";
        audioIcon.classList.add("blinking");
      }

      function stopBlinkingIcon() {
        audioIcon.style.display = "none";
        audioIcon.classList.remove("blinking");
      }

      function showButtons() {
        document.getElementById("retry-button").style.display = "inline-block";
        document.getElementById("exit-button").style.display = "inline-block";
      }

      // 選択された内容に応じてエピソードを再生
      playEpisode(selectedChoice1);

      // ボタンのイベントリスナーを追加
      document
        .getElementById("retry-button")
        .addEventListener("click", function () {
          localStorage.clear(); // データをクリア
          window.location.href = "index.html"; // index.htmlに戻る
        });

      document
        .getElementById("exit-button")
        .addEventListener("click", function () {
          localStorage.clear(); // データをクリア
          window.close(); // ウィンドウを閉じる
        });

      // ページを閉じる際にデータをクリア
      window.addEventListener("beforeunload", function () {
        localStorage.clear();
      });
    </script>
  </body>
</html>
